<div class="dashboard-shell">
  <section class="search-bar glass fade-in">
    <input class="search-input" [(ngModel)]="search" (input)="onSearchChange()" placeholder="Search tickers..." type="text" />
  </section>
  <section class="stocks-grid" *ngIf="!loading; else loadingTpl">
    <div class="stock-card" *ngFor="let stock of stocks; let i = index; trackBy: trackStock" [class.expanded]="expanded === i">
      <button class="card-main" type="button" (click)="expandChip(i)">
        <div class="ticker">{{ stock.symbol }}</div>
        <div class="name" title="{{stock.name}}">{{ stock.name }}</div>
        <div class="spark skeleton" aria-hidden="true"></div>
      </button>
      <div class="card-actions">
        <button class="btn tiny" (click)="addToPortfolio(stock)" [disabled]="stock.added">{{ stock.added ? 'Added' : 'Add' }}</button>
        <button class="btn outline tiny" (click)="showChart(i, stock.symbol)">Data</button>
      </div>
      <div class="chart-wrapper" *ngIf="expanded === i && showChartFor === i">
        <app-tradingview-mini [symbol]="'NASDAQ:' + stock.symbol"></app-tradingview-mini>
      </div>
    </div>
  </section>
  <ng-template #loadingTpl>
    <section class="stocks-grid">
      <div class="stock-card skeleton" *ngFor="let _ of placeholders">
        <div class="skeleton" style="height:14px; width:50%; border-radius:6px;"></div>
        <div class="skeleton" style="height:10px; width:80%; border-radius:6px; margin-top:6px;"></div>
        <div class="skeleton" style="height:32px; width:100%; border-radius:10px; margin-top:12px;"></div>
        <div style="display:flex; gap:.5rem; margin-top:14px;">
          <div class="skeleton" style="height:28px; flex:1; border-radius:8px;"></div>
          <div class="skeleton" style="height:28px; flex:1; border-radius:8px;"></div>
        </div>
      </div>
    </section>
  </ng-template>
</div>
